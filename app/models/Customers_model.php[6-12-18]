<?php defined('BASEPATH') OR exit('No direct script access allowed');



class Customers_model extends CI_Model

{

	

	public function __construct() {

		parent::__construct();

	}

	

	public function getCustomerByID($id) 

	{

		$q = $this->db->get_where('customers', array('id' => $id), 1); 

		if( $q->num_rows() > 0 ) {

			return $q->row();

		} 

		return FALSE;

	}

	

	public function addCustomer($data = array())

	{
		

		if($this->db->insert('customers', $data)) {
			
			

			return $this->db->insert_id();
			
		

		}

		return false;

	}

	

	public function updateCustomer($id, $data = array())

	{

		if($this->db->update('customers', $data, array('id' => $id))) {

			return true;

		}

		return false;

	}

	

	public function deleteCustomer($id) 

	{

		if($this->db->delete('customers', array('id' => $id))) {

			return true;

		}

		return FALSE;

	}

public function getCustomerLaserByCid($cusromer){

        $addArarr = array();
        $salesid = array();
        $purchsesid = array();

        $this->db->select('SUM(opening_blance) as opening_blance');
        $this->db->where('opening_blance !=', '0'); 
        $q = $this->db->get_where('customers', array('id' => $cusromer));
            if($q->num_rows() > 0) {
                foreach (($q->result()) as $row) {
                    $rows['datetime'] = '' ;
                    $rows['total'] = $row->opening_blance ;
                    $rows['pgtotal'] = $row->opening_blance ;
                    $rows['type'] = 'Opening balance';
                    if($row->opening_blance !=''){
                    $results[] = $rows ; 
                    }
                }  
            }
        $this->db->select('*'); 
        $qs = $this->db->get_where('salesreturn', array('customer_id' => $cusromer));
            if($qs->num_rows() > 0) {
                foreach (($qs->result()) as $row) {  
                    $this->db->select('return_amount as return_amount'); 
                    $this->db->where('return_amount !=', '0'); 
                     $ritem = $this->db->get_where('sreturn_items', array('sreturn_id' => $row->sreturn_id));
                        if($ritem->num_rows() > 0) {
                            foreach (($ritem->result()) as $ritems) { 
                                $rows['datetime'] = $row->date_submit;
                                $rows['total'] = $ritems->return_amount;
                                $rows['pgtotal'] = $ritems->return_amount;
                                $rows['type'] = 'Sales Return Amount'; 
                                if($ritems->return_amount !=''){
                                $results[] = $rows ; 
                                }
                            }  
                        } 
                    }
                } 
         $this->db->select('*'); 
        $qs = $this->db->get_where('salesreturn', array('customer_id' => $cusromer));
            if($qs->num_rows() > 0) {
                foreach (($qs->result()) as $row) {  
                    $this->db->select('(real_unit_price * return_qty) as returnamount'); 
                    $this->db->where('return_amount !=', '0'); 
                     $ritem = $this->db->get_where('sreturn_items', array('sreturn_id' => $row->sreturn_id));
                        if($ritem->num_rows() > 0) {
                            foreach (($ritem->result()) as $ritems) { 
                                $rows['datetime'] = $row->date_submit;
                                $rows['total'] = $ritems->returnamount;
                                $rows['pgtotal'] = $ritems->returnamount;
                                $rows['type'] = 'Sales Return'; 
                                if($ritems->returnamount !=''){
                                $results[] = $rows ; 
                                }
                            }  
                        } 
                    }
                } 

        /*$this->db->select('adv_collection.add_date as datetime, adv_collection as advcoll');
        $this->db->where('adv_collection !=', '0');
         $q = $this->db->get_where('adv_collection', array('customer_id' => $cusromer));
            if($q->num_rows() > 0) {
                foreach (($q->result()) as $row) {
                    $rows['datetime'] = $row->datetime ;
                    $rows['total'] = $row->advcoll ;
                    $rows['type'] = 'Advance Collection'; 
                    if($row->advcoll !=''){
                    $results[] = $rows ;
                    }
                }  
            } */

        $this->db->select('sales.id,sales.date as datetime,sales.grand_total');
        $q = $this->db->get_where('sales', array('customer_id' => $cusromer,'sales_type'=>'sale'));
         if($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $rows['datetime'] = $row->datetime ;
                $rows['total'] = $row->grand_total ;
                $rows['sgtotal'] = $row->grand_total ;
                $rows['sale'] = '0.00' ;
                $rows['type'] = 'sale' ;
                $rows['id'] = $row->id;
                $results[] = $rows ;
                $salesid[] = $row->id ;
            }          
        } 
        else return 'No data pound';
        $this->db->select('today_collection.today_collect_id, today_collection.payment_date as datetime, payment_amount as amount');
        $this->db->order_by("today_collect_id","DESC");    
        $q = $this->db->get_where('today_collection', array('customer_id' => $cusromer,));
        if($q->num_rows() > 0) {
            foreach (($q->result()) as $row) {
                $rows['datetime'] = $row->datetime ;
                $rows['total'] = $row->amount ;
                $rows['sgtotal'] = $row->amount ;
                $rows['sale'] = '0.00' ;
                $rows['type'] = 'collection' ;
                $rows['id'] = $row->id ;
                $results[] = $rows ;
            } 

        }  
        return $results; 
    }

}

